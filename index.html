<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thêm Từ Khóa Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f6f8;
            color: #333;
            margin: 0;
            padding: 20px;
            font-size: 14px;
        }

        .keyword-tool-container {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            margin: auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .left-panel, .right-panel {
            padding: 15px;
            border-radius: 6px;
        }

        .left-panel {
            flex: 2; 
            background-color: #fff;
        }

        .right-panel {
            flex: 1; 
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
        }

        h1, h2 {
            color: #1f2937;
            margin-top: 0;
        }
        h1 { font-size: 20px; font-weight: 600; margin-bottom: 20px; }
        h2 { font-size: 16px; font-weight: 600; margin-bottom: 10px; }

        .input-group {
            position: relative;
            margin-bottom: 20px;
        }

        .input-group input[type="text"] {
            width: calc(100% - 40px);
            padding: 10px 30px 10px 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
        }
        .input-group .search-icon {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            cursor: pointer;
        }

        .suggestions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .btn {
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: background-color 0.2s ease;
        }

        .btn-primary {
            background-color: #ef4444; 
            color: white;
            border: 1px solid #ef4444;
        }
        .btn-primary:hover { background-color: #dc2626; }

        .btn-secondary {
            background-color: #fff;
            color: #ef4444;
            border: 1px solid #ef4444;
        }
        .btn-secondary:hover { background-color: #fee2e2; }

        .btn-outline {
            background-color: transparent;
            color: #6b7280;
            border: 1px solid #d1d5db;
        }
        .btn-outline:hover { background-color: #f3f4f6; }


        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        th, td {
            text-align: left;
            padding: 10px 8px;
            border-bottom: 1px solid #e5e7eb;
        }
        th {
            background-color: #f9fafb;
            color: #6b7280;
            font-weight: 500;
            position: sticky; /* CẦN THIẾT CHO THANH CUỘN HEADER CỐ ĐỊNH */
            top: 0; /* CẦN THIẾT CHO THANH CUỘN HEADER CỐ ĐỊNH */
            z-index: 1; /* Đảm bảo header nổi trên nội dung cuộn */
        }
        td .action-add {
            color: #ef4444;
            cursor: pointer;
            font-weight: 500;
        }
        td .action-add:hover { text-decoration: underline; }

        .tooltip-icon {
            color: #9ca3af;
            font-size: 12px;
            cursor: help;
        }

        .added-keywords-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .empty-state {
            text-align: center;
            color: #9ca3af;
            padding: 40px 20px;
        }
        .empty-state img { width: 60px; opacity: 0.7; margin-bottom: 10px; }

        .right-panel-footer {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        /* --- THAY ĐỔI CSS CHO THANH CUỘN --- */
        .table-container {
            max-height: 400px; /* Đặt chiều cao tối đa cho bảng gợi ý */
            overflow-y: auto; /* Thêm thanh cuộn dọc khi cần */
            border: 1px solid #e5e7eb;
            border-top: none; /* Bỏ border top vì header table đã có */
            border-radius: 0 0 6px 6px;
        }
        .table-container table thead th { /* Đảm bảo header không bị border của container che */
             border-bottom: 1px solid #e5e7eb; /* Giữ border bottom cho header */
        }

        .copied-feedback { /* CSS cho thông báo copy thành công */
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .copied-feedback.show {
            opacity: 1;
        }

    </style>
</head>
<body>

<div class="keyword-tool-container">
    <div class="left-panel">
        <h1>Thêm từ khóa</h1>
        <div class="input-group">
            <input type="text" id="seedKeywordInput" placeholder="Nhập từ khóa của bạn tại đây">
            <span class="search-icon" id="searchIcon"></span>
        </div>

        <div class="suggestions-header">
            <h2>Các từ khóa được đề xuất (<span id="suggestionCount">0</span>) <span class="tooltip-icon" title="Các từ khóa này được gợi ý dựa trên từ khóa bạn nhập">?</span></h2>
            <button class="btn btn-secondary" id="addAllSuggestionsBtn" disabled>+ Thêm tất cả các từ khóa được đề xuất</button>
        </div>

        <!-- --- THAY ĐỔI HTML: WRAP TABLE TRONG .table-container --- -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Từ khóa</th>
                        <th>Chất lượng từ khóa <span class="tooltip-icon" title="Điểm chất lượng dự kiến">?</span></th>
                        <th>Tỉ lệ tìm kiếm <span class="tooltip-icon" title="Lượng tìm kiếm tương đối">?</span></th>
                        <th>Giá thầu tham khảo <span class="tooltip-icon" title="Giá thầu gợi ý cho mỗi click">?</span></th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody id="suggestionsTableBody">
                    <tr><td colspan="5" style="text-align:center; color:#9ca3af; padding: 20px;">Nhập từ khóa để xem gợi ý.</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="right-panel">
        <div class="added-keywords-header">
            <h2>Từ khóa đã thêm (<span id="addedCount">0</span>) <span class="tooltip-icon" title="Các từ khóa bạn đã chọn để thêm vào chiến dịch">?</span></h2>
            <button class="btn btn-outline" id="removeAllAddedBtn" disabled>Xóa hết</button>
        </div>
        <div id="addedKeywordsList">
            <div class="empty-state" id="emptyAddedState">
                <img src="data:image/svg+xml;base64,PHN2ZyBhcmlhLWhpZGRlbj0idHJ1ZSIgZm9jdXNhYmxlPSJmYWxzZSIgZGF0YS1wcmVmaXg9ImZhciIgZGF0YS1pY29uPSJmaWxlLWFsdCIgY2xhc3M9InN2Zy1pbmxpbmUtLWZhIGZhLWZpbGUtYWx0IGZhLXctMTIiIHJvbGU9ImltZyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMzg0IDUxMiI+PHBhdGggZmlsbD0iY3VycmVudENvbG9yIiBkPSJNMzg0LDEyOEgyNTZDMTk4LjEsMTI4LDEyOCwxOTguMSwxMjgsMjU2djE5MmMwLDUzLDQzLDEwMiw5Ni4xLDEwMkgzNTJjMTcuNywwLDMyLTE0LjMsMzItMzJWMTEyQzM4NCwxMTEuMSwzNzIuMSw5NiwzNTIsOTZoLTU3LjNsLTQwLTQwSDI1NmMtMjAuMywwLTM2LjcsMTMuMi00MS4zLDMySDEyOEwyMTIsOTZIMzUyeiBNMjU2LDQ0OEgxNjBjLTM1LjMsMC02NC0yOC43LTY0LTY0VjI1NmMwLTM1LjMsMjguNy02NCw2NC02NGg5NnYxMjhIMjU2djEyOEgyNTZ6IE0zNTIsNDQ4SDI4OFYyODhIMzUyVjQ0OHoiPjwvcGF0aD48L3N2Zz4=" alt="empty list">
                <p>Bạn chưa chọn từ khóa nào</p>
            </div>
            <table id="addedKeywordsTable" style="display:none;">
                <thead>
                    <tr>
                        <th>Từ khóa</th>
                        <th>Giá thầu <span class="tooltip-icon" title="Giá thầu bạn đã đặt hoặc giá thầu tham khảo">?</span></th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody id="addedKeywordsTableBody">
                </tbody>
            </table>
        </div>
        <div class="right-panel-footer">
            <button class="btn btn-outline" id="cancelBtn" disabled>Hủy</button>
            <!-- --- THAY ĐỔI HTML: NÚT "XÁC NHẬN" THÀNH "COPY TỪ KHÓA" --- -->
            <button class="btn btn-primary" id="copyKeywordsBtn" disabled>Copy từ khóa</button>
        </div>
    </div>
</div>
<!-- --- THÊM HTML CHO THÔNG BÁO COPY --- -->
<div id="copiedFeedback" class="copied-feedback">Đã copy từ khóa vào clipboard!</div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    const seedKeywordInput = document.getElementById('seedKeywordInput');
    const searchIcon = document.getElementById('searchIcon');
    const suggestionCountSpan = document.getElementById('suggestionCount');
    const addAllSuggestionsBtn = document.getElementById('addAllSuggestionsBtn');
    const suggestionsTableBody = document.getElementById('suggestionsTableBody');
    
    const addedCountSpan = document.getElementById('addedCount');
    const removeAllAddedBtn = document.getElementById('removeAllAddedBtn');
    const emptyAddedState = document.getElementById('emptyAddedState');
    const addedKeywordsTable = document.getElementById('addedKeywordsTable');
    const addedKeywordsTableBody = document.getElementById('addedKeywordsTableBody');

    const cancelBtn = document.getElementById('cancelBtn');
    // --- THAY ĐỔI JS: THAM CHIẾU NÚT MỚI ---
    const copyKeywordsBtn = document.getElementById('copyKeywordsBtn');
    const copiedFeedback = document.getElementById('copiedFeedback'); // Tham chiếu thông báo

    // --- DỮ LIỆU GIẢ LẬP (MỞ RỘNG ĐỂ CÓ NHIỀU GỢI Ý HƠN) ---
    const mockKeywordData = {
        "áo": [
            { id: 1, text: "áo thun nam", quality: "10/10", volume: 8961, bid: 3380, added: false },
            { id: 2, text: "áo khoác nữ", quality: "9/10", volume: 12030, bid: 2800, added: false  },
            { id: 3, text: "áo sơ mi trắng", quality: "8/10", volume: 5500, bid: 4100, added: false  },
            { id: 4, text: "áo polo nam hàng hiệu", quality: "10/10", volume: 7800, bid: 3000, added: false  },
            { id: 16, text: "áo len cổ lọ", quality: "7/10", volume: 3200, bid: 2500, added: false },
            { id: 17, text: "áo hoodie local brand", quality: "9/10", volume: 9500, bid: 3800, added: false },
            { id: 18, text: "áo croptop ôm body", quality: "8/10", volume: 6100, bid: 2700, added: false },
            { id: 19, text: "áo dài cách tân", quality: "10/10", volume: 11500, bid: 4500, added: false },
            { id: 20, text: "áo gió chống nước", quality: "9/10", volume: 7200, bid: 3200, added: false },
            { id: 21, text: "áo ba lỗ thể thao", quality: "7/10", volume: 2800, bid: 1900, added: false },
            { id: 22, text: "áo nỉ có mũ", quality: "8/10", volume: 5900, bid: 2900, added: false },
        ],
        "quần": [
            { id: 5, text: "quần jean ống rộng nữ", quality: "9/10", volume: 15200, bid: 3700, added: false  },
            { id: 6, text: "quần short nam kaki", quality: "10/10", volume: 6700, bid: 2200, added: false  },
            { id: 7, text: "quần tây nữ công sở", quality: "8/10", volume: 4300, bid: 3100, added: false  },
            { id: 23, text: "quần baggy vải", quality: "9/10", volume: 8800, bid: 2600, added: false },
            { id: 24, text: "quần jogger thể thao", quality: "10/10", volume: 7100, bid: 2400, added: false },
             { id: 25, text: "quần lót nam cotton", quality: "8/10", volume: 10500, bid: 1800, added: false },
            { id: 26, text: "quần culottes ống rộng", quality: "9/10", volume: 6500, bid: 3300, added: false },
            { id: 27, text: "quần yếm jean", quality: "7/10", volume: 3900, bid: 2900, added: false },
            { id: 28, text: "quần legging tập gym", quality: "10/10", volume: 9200, bid: 2100, added: false },
            { id: 29, text: "quần đũi nam", quality: "8/10", volume: 5300, bid: 2700, added: false },
        ],
        "váy": [
            { id: 8, text: "váy công chúa bé gái", quality: "10/10", volume: 9500, bid: 2900, added: false  },
            { id: 9, text: "váy maxi đi biển voan", quality: "9/10", volume: 11000, bid: 3500, added: false  },
            { id: 30, text: "váy body dự tiệc sang trọng", quality: "8/10", volume: 7500, bid: 4200, added: false },
            { id: 31, text: "váy babydoll dễ thương", quality: "9/10", volume: 6800, bid: 2800, added: false },
            { id: 32, text: "váy hai dây lụa", quality: "7/10", volume: 4200, bid: 3100, added: false },
            { id: 33, text: "váy xòe công sở", quality: "10/10", volume: 8900, bid: 3300, added: false },
        ],
        "bông tẩy trang": [
            { id: 10, text: "bông tẩy trang Ipek 120 miếng", quality: "10/10", volume: 25000, bid: 1500, added: false  },
            { id: 11, text: "bông tẩy trang Silcot hộp xanh", quality: "9/10", volume: 18000, bid: 1800, added: false  },
            { id: 12, text: "bông tẩy trang Lameila túi zip", quality: "7/10", volume: 10000, bid: 900, added: false  },
            { id: 34, text: "bông tẩy trang Ceibaオーガニックコットン", quality: "8/10", volume: 12000, bid: 2200, added: false }, //Thêm chữ Nhật
            { id: 35, text: "bông tẩy trang Aura Beauty", quality: "9/10", volume: 15000, bid: 1600, added: false },
            { id: 36, text: "bông tẩy trang Muji", quality: "10/10", volume: 19000, bid: 2500, added: false },
        ],
         "befou bông tẩy trang": [
            { id: 13, text: "befou bông tẩy trang 👍", quality: "10/10", volume: 8961, bid: 3380, added: false  },
        ],
        "bông": [
             { id: 14, text: "bông 👍", quality: "10/10", volume: 79937, bid: 1001, added: false  },
        ],
        "bông tẩy": [
             { id: 15, text: "bông tẩy 👍", quality: "10/10", volume: 3839, bid: 2702, added: false  },
        ]
    };

    let currentSuggestions = [];
    let addedKeywords = [];

    function formatNumber(num) {
        return num.toLocaleString('vi-VN');
    }

    function renderSuggestions() {
        suggestionsTableBody.innerHTML = '';
        // --- THAY ĐỔI JS: GIỚI HẠN SỐ LƯỢNG GỢI Ý HIỂN THỊ BAN ĐẦU, CÓ THỂ BỎ QUA NẾU MUỐN HIỂN THỊ TẤT CẢ ---
        const suggestionsToDisplay = currentSuggestions; // Hiển thị tất cả gợi ý tìm được

        if (suggestionsToDisplay.length === 0 && seedKeywordInput.value.trim() !== "") {
            suggestionsTableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:#9ca3af; padding: 20px;">Không tìm thấy gợi ý nào.</td></tr>`;
            addAllSuggestionsBtn.disabled = true;
        } else if (seedKeywordInput.value.trim() === "") {
             suggestionsTableBody.innerHTML = `<tr><td colspan="5" style="text-align:center; color:#9ca3af; padding: 20px;">Nhập từ khóa để xem gợi ý.</td></tr>`;
             addAllSuggestionsBtn.disabled = true;
        }
        else {
            suggestionsToDisplay.forEach(kw => {
                const row = suggestionsTableBody.insertRow();
                row.innerHTML = `
                    <td>${kw.text}</td>
                    <td>${kw.quality}</td>
                    <td>${formatNumber(kw.volume)}</td>
                    <td>₫${formatNumber(kw.bid)}</td>
                    <td>
                        ${addedKeywords.find(k => k.id === kw.id) ? 
                            '<span style="color:#9ca3af;">Đã thêm</span>' : 
                            `<span class="action-add" data-id="${kw.id}">+ Thêm</span>`}
                    </td>
                `;
            });
            // Kiểm tra xem tất cả các gợi ý hiện tại đã được thêm chưa
            const allCurrentDisplayedAdded = suggestionsToDisplay.every(kw => addedKeywords.find(k => k.id === kw.id));
            addAllSuggestionsBtn.disabled = suggestionsToDisplay.length === 0 || allCurrentDisplayedAdded;
        }
        suggestionCountSpan.textContent = currentSuggestions.length; // Vẫn hiển thị tổng số gợi ý tìm được
    }

    function renderAddedKeywords() {
        addedKeywordsTableBody.innerHTML = '';
        if (addedKeywords.length === 0) {
            emptyAddedState.style.display = 'block';
            addedKeywordsTable.style.display = 'none';
            removeAllAddedBtn.disabled = true;
            copyKeywordsBtn.disabled = true; // --- THAY ĐỔI JS ---
            cancelBtn.disabled = true;

        } else {
            emptyAddedState.style.display = 'none';
            addedKeywordsTable.style.display = 'table';
            addedKeywords.forEach(kw => {
                const row = addedKeywordsTableBody.insertRow();
                row.innerHTML = `
                    <td>${kw.text}</td>
                    <td>₫${formatNumber(kw.bid)}</td>
                    <td><span class="action-add" data-id="${kw.id}" data-remove="true" style="color:#6b7280;">Xóa</span></td>
                `;
            });
            removeAllAddedBtn.disabled = false;
            copyKeywordsBtn.disabled = false; // --- THAY ĐỔI JS ---
            cancelBtn.disabled = false;
        }
        addedCountSpan.textContent = addedKeywords.length;
        if (currentSuggestions.length > 0) renderSuggestions();
    }
    
    function findSuggestions(seed) {
        currentSuggestions = [];
        if (!seed) {
            renderSuggestions();
            return;
        }
        const seedLower = seed.toLowerCase();
        for (const key in mockKeywordData) {
            if (key.toLowerCase().includes(seedLower)) {
                 mockKeywordData[key].forEach(kw => {
                    if (!currentSuggestions.find(s => s.id === kw.id)) {
                        currentSuggestions.push(kw);
                    }
                });
            }
            mockKeywordData[key].forEach(kw => {
                if (kw.text.toLowerCase().includes(seedLower)) {
                     if (!currentSuggestions.find(s => s.id === kw.id)) {
                        currentSuggestions.push(kw);
                    }
                }
            });
        }
        currentSuggestions.sort((a,b) => b.volume - a.volume);
        renderSuggestions();
    }

    seedKeywordInput.addEventListener('input', () => {
        findSuggestions(seedKeywordInput.value.trim());
    });
    searchIcon.addEventListener('click', () => {
        findSuggestions(seedKeywordInput.value.trim());
    });


    suggestionsTableBody.addEventListener('click', (event) => {
        if (event.target.classList.contains('action-add') && event.target.dataset.id) {
            const keywordId = parseInt(event.target.dataset.id);
            const keywordToAdd = Object.values(mockKeywordData).flat().find(kw => kw.id === keywordId); // Tìm trong toàn bộ data

            if (keywordToAdd && !addedKeywords.find(k => k.id === keywordId)) {
                addedKeywords.push(keywordToAdd);
                renderAddedKeywords();
            }
        }
    });
    
    addedKeywordsTableBody.addEventListener('click', (event) => {
        if (event.target.dataset.remove === 'true' && event.target.dataset.id) {
            const keywordIdToRemove = parseInt(event.target.dataset.id);
            addedKeywords = addedKeywords.filter(kw => kw.id !== keywordIdToRemove);
            renderAddedKeywords();
        }
    });

    addAllSuggestionsBtn.addEventListener('click', () => {
        currentSuggestions.forEach(kw => {
            if (!addedKeywords.find(k => k.id === kw.id)) {
                addedKeywords.push(kw);
            }
        });
        renderAddedKeywords();
    });

    removeAllAddedBtn.addEventListener('click', () => {
        if (confirm('Bạn có chắc muốn xóa tất cả các từ khóa đã thêm không?')) {
            addedKeywords = [];
            renderAddedKeywords();
        }
    });

    cancelBtn.addEventListener('click', () => {
        // Có thể reset lại trạng thái nếu cần, ví dụ xóa input, xóa gợi ý, xóa danh sách đã thêm
        if (confirm('Bạn có chắc muốn hủy và xóa mọi thao tác hiện tại?')) {
            seedKeywordInput.value = '';
            currentSuggestions = [];
            addedKeywords = [];
            renderSuggestions();
            renderAddedKeywords();
        }
    });

    // --- THAY ĐỔI JS: CHỨC NĂNG NÚT COPY ---
    copyKeywordsBtn.addEventListener('click', () => {
        if (addedKeywords.length > 0) {
            const keywordsToCopy = addedKeywords.map(kw => kw.text).join('\n'); // Mỗi từ khóa trên một dòng mới
            navigator.clipboard.writeText(keywordsToCopy)
                .then(() => {
                    // Hiển thị thông báo thành công
                    copiedFeedback.classList.add('show');
                    setTimeout(() => {
                        copiedFeedback.classList.remove('show');
                    }, 2000); // Ẩn sau 2 giây
                })
                .catch(err => {
                    console.error('Lỗi khi copy từ khóa: ', err);
                    alert('Không thể copy từ khóa. Vui lòng thử lại hoặc copy thủ công.');
                });
        } else {
            alert('Vui lòng chọn ít nhất một từ khóa để copy.');
        }
    });

    renderAddedKeywords();
});
</script>

</body>
</html>
